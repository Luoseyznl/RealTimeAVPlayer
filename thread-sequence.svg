<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1645px" preserveAspectRatio="none" style="width:2293px;height:1645px;" version="1.1" viewBox="0 0 2293 1645" width="2293px" zoomAndPan="magnify"><defs><filter height="300%" id="fplbp3eas8i4d" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#fplbp3eas8i4d)" height="159.5301" style="stroke: #000000; stroke-width: 2.0;" width="1344.5" x="927" y="587.9521"/><rect fill="#FFFFFF" filter="url(#fplbp3eas8i4d)" height="83.118" style="stroke: #000000; stroke-width: 2.0;" width="1384.5" x="181.5" y="1391.8965"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="26" x2="26" y1="89.0679" y2="1555.4266"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="155.5" x2="155.5" y1="89.0679" y2="1555.4266"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="220.5" x2="220.5" y1="89.0679" y2="1555.4266"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="423.5" x2="423.5" y1="89.0679" y2="1555.4266"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="551.5" x2="551.5" y1="89.0679" y2="1555.4266"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="697.5" x2="697.5" y1="89.0679" y2="1555.4266"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="827.5" x2="827.5" y1="89.0679" y2="1555.4266"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="978" x2="978" y1="89.0679" y2="1555.4266"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1160" x2="1160" y1="89.0679" y2="1555.4266"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1354" x2="1354" y1="89.0679" y2="1555.4266"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1498" x2="1498" y1="89.0679" y2="1555.4266"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1638" x2="1638" y1="89.0679" y2="1555.4266"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1780" x2="1780" y1="89.0679" y2="1555.4266"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2130.5" x2="2130.5" y1="89.0679" y2="1555.4266"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="2212.5" x2="2212.5" y1="89.0679" y2="1555.4266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="31" x="8" y="84.9659">User</text><ellipse cx="26.5" cy="13" fill="#FEFECE" filter="url(#fplbp3eas8i4d)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M26.5,21 L26.5,48 M13.5,29 L39.5,29 M26.5,48 L13.5,63 M26.5,48 L39.5,63 " fill="none" filter="url(#fplbp3eas8i4d)" style="stroke: #A80036; stroke-width: 2.0;"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="31" x="8" y="1569.3926">User</text><ellipse cx="26.5" cy="1583.4945" fill="#FEFECE" filter="url(#fplbp3eas8i4d)" rx="8" ry="8" style="stroke: #A80036; stroke-width: 2.0;"/><path d="M26.5,1591.4945 L26.5,1618.4945 M13.5,1599.4945 L39.5,1599.4945 M26.5,1618.4945 L13.5,1633.4945 M26.5,1618.4945 L39.5,1633.4945 " fill="none" filter="url(#fplbp3eas8i4d)" style="stroke: #A80036; stroke-width: 2.0;"/><rect fill="#FEFECE" filter="url(#fplbp3eas8i4d)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="48" x="129.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="34" x="136.5" y="72.9659">Main</text><rect fill="#FEFECE" filter="url(#fplbp3eas8i4d)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="48" x="129.5" y="1554.4266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="34" x="136.5" y="1576.3926">Main</text><rect fill="#FEFECE" filter="url(#fplbp3eas8i4d)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="55" x="191.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="41" x="198.5" y="72.9659">Player</text><rect fill="#FEFECE" filter="url(#fplbp3eas8i4d)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="55" x="191.5" y="1554.4266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="41" x="198.5" y="1576.3926">Player</text><rect fill="#FEFECE" filter="url(#fplbp3eas8i4d)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="75" x="384.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="61" x="391.5" y="72.9659">Demuxer</text><rect fill="#FEFECE" filter="url(#fplbp3eas8i4d)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="75" x="384.5" y="1554.4266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="61" x="391.5" y="1576.3926">Demuxer</text><rect fill="#FEFECE" filter="url(#fplbp3eas8i4d)" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="151" x="474.5" y="31.9321"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="137" x="481.5" y="53.898">Audio StreamSource</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="120" x="490" y="72.9659">(decoding thread)</text><rect fill="#FEFECE" filter="url(#fplbp3eas8i4d)" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="151" x="474.5" y="1554.4266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="137" x="481.5" y="1576.3926">Audio StreamSource</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="120" x="490" y="1595.4605">(decoding thread)</text><rect fill="#FEFECE" filter="url(#fplbp3eas8i4d)" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="113" x="639.5" y="31.9321"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="99" x="646.5" y="53.898">Audio Decoder</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="79" x="656.5" y="72.9659">(+resample)</text><rect fill="#FEFECE" filter="url(#fplbp3eas8i4d)" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="113" x="639.5" y="1554.4266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="99" x="646.5" y="1576.3926">Audio Decoder</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="79" x="656.5" y="1595.4605">(+resample)</text><rect fill="#FEFECE" filter="url(#fplbp3eas8i4d)" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="766.5" y="31.9321"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="773.5" y="53.898">Audio Producer</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="53" x="799" y="72.9659">(thread)</text><rect fill="#FEFECE" filter="url(#fplbp3eas8i4d)" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="118" x="766.5" y="1554.4266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="104" x="773.5" y="1576.3926">Audio Producer</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="53" x="799" y="1595.4605">(thread)</text><rect fill="#FEFECE" filter="url(#fplbp3eas8i4d)" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="79" x="937" y="31.9321"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="65" x="944" y="53.898">PCM Ring</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="955.5" y="72.9659">Buffer</text><rect fill="#FEFECE" filter="url(#fplbp3eas8i4d)" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="79" x="937" y="1554.4266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="65" x="944" y="1576.3926">PCM Ring</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="42" x="955.5" y="1595.4605">Buffer</text><rect fill="#FEFECE" filter="url(#fplbp3eas8i4d)" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="169" x="1074" y="31.9321"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="68" x="1124.5" y="53.898">SDL Audio</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="155" x="1081" y="72.9659">Callback (audio thread)</text><rect fill="#FEFECE" filter="url(#fplbp3eas8i4d)" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="169" x="1074" y="1554.4266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="68" x="1124.5" y="1576.3926">SDL Audio</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="155" x="1081" y="1595.4605">Callback (audio thread)</text><rect fill="#FEFECE" filter="url(#fplbp3eas8i4d)" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="149" x="1278" y="31.9321"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="135" x="1285" y="53.898">Video StreamSource</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="120" x="1292.5" y="72.9659">(decoding thread)</text><rect fill="#FEFECE" filter="url(#fplbp3eas8i4d)" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="149" x="1278" y="1554.4266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="135" x="1285" y="1576.3926">Video StreamSource</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="120" x="1292.5" y="1595.4605">(decoding thread)</text><rect fill="#FEFECE" filter="url(#fplbp3eas8i4d)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="111" x="1441" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="97" x="1448" y="72.9659">Video Decoder</text><rect fill="#FEFECE" filter="url(#fplbp3eas8i4d)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="111" x="1441" y="1554.4266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="97" x="1448" y="1576.3926">Video Decoder</text><rect fill="#FEFECE" filter="url(#fplbp3eas8i4d)" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="140" x="1566" y="31.9321"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="126" x="1573" y="53.898">Player RenderLoop</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="103" x="1584.5" y="72.9659">(render thread)</text><rect fill="#FEFECE" filter="url(#fplbp3eas8i4d)" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="140" x="1566" y="1554.4266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="126" x="1573" y="1576.3926">Player RenderLoop</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="103" x="1584.5" y="1595.4605">(render thread)</text><rect fill="#FEFECE" filter="url(#fplbp3eas8i4d)" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="117" x="1720" y="31.9321"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="1738.5" y="53.898">GLRenderer</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="103" x="1727" y="72.9659">(render thread)</text><rect fill="#FEFECE" filter="url(#fplbp3eas8i4d)" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="117" x="1720" y="1554.4266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="1738.5" y="1576.3926">GLRenderer</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="103" x="1727" y="1595.4605">(render thread)</text><rect fill="#FEFECE" filter="url(#fplbp3eas8i4d)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="42" x="2107.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="28" x="2114.5" y="72.9659">GPU</text><rect fill="#FEFECE" filter="url(#fplbp3eas8i4d)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="42" x="2107.5" y="1554.4266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="28" x="2114.5" y="1576.3926">GPU</text><rect fill="#FEFECE" filter="url(#fplbp3eas8i4d)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="2163.5" y="51"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="2170.5" y="72.9659">AudioPlayer</text><rect fill="#FEFECE" filter="url(#fplbp3eas8i4d)" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="94" x="2163.5" y="1554.4266"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="80" x="2170.5" y="1576.3926">AudioPlayer</text><rect fill="#EEEEEE" filter="url(#fplbp3eas8i4d)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="2278.5" x="3" y="120.9209"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2281.5" y1="120.9209" y2="120.9209"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2281.5" y1="123.9209" y2="123.9209"/><rect fill="#EEEEEE" filter="url(#fplbp3eas8i4d)" height="25.706" style="stroke: #000000; stroke-width: 2.0;" width="88" x="1098.25" y="109.0679"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="71" x="1104.25" y="126.9649">Start / Play</text><polygon fill="#A80036" points="143.5,164.4799,153.5,168.4799,143.5,172.4799,147.5,168.4799" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="26.5" x2="149.5" y1="168.4799" y2="168.4799"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="105" x="33.5" y="162.6709">open(file) &amp; play()</text><polygon fill="#A80036" points="209,196.186,219,200.186,209,204.186,213,200.186" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="155.5" x2="215" y1="200.186" y2="200.186"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="33" x="162.5" y="194.377">play()</text><polygon fill="#A80036" points="412,227.892,422,231.892,412,235.892,416,231.892" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="221" x2="418" y1="231.892" y2="231.892"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="113" x="228" y="226.083">open / get streams</text><polygon fill="#A80036" points="540,259.598,550,263.598,540,267.598,544,263.598" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="221" x2="546" y1="263.598" y2="263.598"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="93" x="228" y="257.789">startDecoding()</text><polygon fill="#A80036" points="1342.5,291.304,1352.5,295.304,1342.5,299.304,1346.5,295.304" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="221" x2="1348.5" y1="295.304" y2="295.304"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="93" x="228" y="289.495">startDecoding()</text><rect fill="#EEEEEE" filter="url(#fplbp3eas8i4d)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="2278.5" x="3" y="325.157"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2281.5" y1="325.157" y2="325.157"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2281.5" y1="328.157" y2="328.157"/><rect fill="#EEEEEE" filter="url(#fplbp3eas8i4d)" height="25.706" style="stroke: #000000; stroke-width: 2.0;" width="165" x="1059.75" y="313.304"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="148" x="1065.75" y="331.201">Audio production path</text><polygon fill="#A80036" points="435,368.716,425,372.716,435,376.716,431,372.716" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="429" x2="551" y1="372.716" y2="372.716"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="441" y="366.907">readNextPacket()</text><polygon fill="#A80036" points="540,400.4221,550,404.4221,540,408.4221,544,404.4221" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="424" x2="546" y1="404.4221" y2="404.4221"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="40" x="431" y="398.6131">packet</text><polygon fill="#A80036" points="686,432.1281,696,436.1281,686,440.1281,690,436.1281" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="552" x2="692" y1="436.1281" y2="436.1281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="559" y="430.3191">decodePacket()</text><polygon fill="#A80036" points="563,463.8341,553,467.8341,563,471.8341,559,467.8341" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="557" x2="697" y1="467.8341" y2="467.8341"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="99" x="569" y="462.0251">AVFrame (audio)</text><polygon fill="#A80036" points="815.5,495.5401,825.5,499.5401,815.5,503.5401,819.5,499.5401" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="552" x2="821.5" y1="499.5401" y2="499.5401"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="186" x="559" y="493.7311">resample &amp; planar→interleaved</text><polygon fill="#A80036" points="966.5,527.2461,976.5,531.2461,966.5,535.2461,970.5,531.2461" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="827.5" x2="972.5" y1="531.2461" y2="531.2461"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="834.5" y="525.4371">pushPCMData(bytes)</text><path d="M805,544.2461 L805,571.2461 L1147,571.2461 L1147,554.2461 L1137,544.2461 L805,544.2461 " fill="#FBFB77" filter="url(#fplbp3eas8i4d)" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1137,544.2461 L1137,554.2461 L1147,554.2461 L1137,544.2461 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="321" x="811" y="563.1431">ring stores interleaved S16, base_pts set on first frame</text><path d="M927,587.9521 L1000,587.9521 L1000,596.9521 L990,606.9521 L927,606.9521 L927,587.9521 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="159.5301" style="stroke: #000000; stroke-width: 2.0;" width="1344.5" x="927" y="587.9521"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="942" y="602.8492">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="171" x="1015" y="601.7111">[Device needs audio (periodic)]</text><polygon fill="#A80036" points="989.5,627.3642,979.5,631.3642,989.5,635.3642,985.5,631.3642" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="983.5" x2="1159.5" y1="631.3642" y2="631.3642"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="995.5" y="625.5552">popPCMData(request_len)</text><polygon fill="#A80036" points="1148.5,659.0702,1158.5,663.0702,1148.5,667.0702,1152.5,663.0702" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="978.5" x2="1154.5" y1="663.0702" y2="663.0702"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="985.5" y="657.2612">bytes or silence</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="1160.5" x2="1202.5" y1="694.7762" y2="694.7762"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1202.5" x2="1202.5" y1="694.7762" y2="707.7762"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1161.5" x2="1202.5" y1="707.7762" y2="707.7762"/><polygon fill="#A80036" points="1171.5,703.7762,1161.5,707.7762,1171.5,711.7762,1167.5,707.7762" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="180" x="1167.5" y="688.9672">apply volume (use tmp buffer)</text><polygon fill="#A80036" points="2200.5,735.4822,2210.5,739.4822,2200.5,743.4822,2204.5,739.4822" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1160.5" x2="2206.5" y1="739.4822" y2="739.4822"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="311" x="1167.5" y="733.6732">update audio_clock (base_pts + consumed_samples)</text><rect fill="#EEEEEE" filter="url(#fplbp3eas8i4d)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="2278.5" x="3" y="776.3352"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2281.5" y1="776.3352" y2="776.3352"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2281.5" y1="779.3352" y2="779.3352"/><rect fill="#EEEEEE" filter="url(#fplbp3eas8i4d)" height="25.706" style="stroke: #000000; stroke-width: 2.0;" width="147" x="1068.75" y="764.4822"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="130" x="1074.75" y="782.3792">Video path and sync</text><polygon fill="#A80036" points="435,819.8943,425,823.8943,435,827.8943,431,823.8943" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="429" x2="1353.5" y1="823.8943" y2="823.8943"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="441" y="818.0853">readNextPacket()</text><polygon fill="#A80036" points="1342.5,851.6003,1352.5,855.6003,1342.5,859.6003,1346.5,855.6003" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="424" x2="1348.5" y1="855.6003" y2="855.6003"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="40" x="431" y="849.7913">packet</text><polygon fill="#A80036" points="1486.5,883.3063,1496.5,887.3063,1486.5,891.3063,1490.5,887.3063" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1354.5" x2="1492.5" y1="887.3063" y2="887.3063"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="1361.5" y="881.4973">decodePacket()</text><polygon fill="#A80036" points="1365.5,915.0123,1355.5,919.0123,1365.5,923.0123,1361.5,919.0123" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="1359.5" x2="1497.5" y1="919.0123" y2="919.0123"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="1371.5" y="913.2033">AVFrame (video)</text><polygon fill="#A80036" points="232,946.7183,222,950.7183,232,954.7183,228,950.7183" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="226" x2="1353.5" y1="950.7183" y2="950.7183"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="166" x="238" y="944.9093">pushFrameToQueue(frame)</text><polygon fill="#A80036" points="1626,978.4243,1636,982.4243,1626,986.4243,1630,982.4243" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="221" x2="1632" y1="982.4243" y2="982.4243"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="188" x="228" y="976.6153">renderLoop() reads audio_clock</text><polygon fill="#A80036" points="232,1010.1304,222,1014.1304,232,1018.1304,228,1014.1304" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="226" x2="1637" y1="1014.1304" y2="1014.1304"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="328" x="238" y="1008.3214">request next frame (based on audio_clock / thresholds)</text><polygon fill="#A80036" points="1768.5,1041.8364,1778.5,1045.8364,1768.5,1049.8364,1772.5,1045.8364" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="221" x2="1774.5" y1="1045.8364" y2="1045.8364"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="189" x="228" y="1040.0274">enqueueFrame(selected_frame)</text><polygon fill="#A80036" points="2118.5,1073.5424,2128.5,1077.5424,2118.5,1081.5424,2122.5,1077.5424" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1780.5" x2="2124.5" y1="1077.5424" y2="1077.5424"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="326" x="1787.5" y="1071.7334">upload Y/U/V (glTexSubImage2D) + shader (YUV-&gt;RGB)</text><polygon fill="#A80036" points="1791.5,1105.2484,1781.5,1109.2484,1791.5,1113.2484,1787.5,1109.2484" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1785.5" x2="2129.5" y1="1109.2484" y2="1109.2484"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="197" x="1797.5" y="1103.4394">rasterize &amp; present (swapBuffers)</text><rect fill="#EEEEEE" filter="url(#fplbp3eas8i4d)" height="3" style="stroke: #EEEEEE; stroke-width: 1.0;" width="2278.5" x="3" y="1139.1014"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2281.5" y1="1139.1014" y2="1139.1014"/><line style="stroke: #000000; stroke-width: 1.0;" x1="3" x2="2281.5" y1="1142.1014" y2="1142.1014"/><rect fill="#EEEEEE" filter="url(#fplbp3eas8i4d)" height="25.706" style="stroke: #000000; stroke-width: 2.0;" width="119" x="1082.75" y="1127.2484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="102" x="1088.75" y="1145.1454">Seek flow (user)</text><polygon fill="#A80036" points="209,1182.6604,219,1186.6604,209,1190.6604,213,1186.6604" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="26.5" x2="215" y1="1186.6604" y2="1186.6604"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="89" x="33.5" y="1180.8514">seek(target_ts)</text><polygon fill="#A80036" points="1148.5,1214.3665,1158.5,1218.3665,1148.5,1222.3665,1152.5,1218.3665" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="221" x2="1154.5" y1="1218.3665" y2="1218.3665"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="77" x="228" y="1212.5575">pause device</text><polygon fill="#A80036" points="1768.5,1246.0725,1778.5,1250.0725,1768.5,1254.0725,1772.5,1250.0725" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="221" x2="1774.5" y1="1250.0725" y2="1250.0725"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="98" x="228" y="1244.2635">pause rendering</text><polygon fill="#A80036" points="412,1277.7785,422,1281.7785,412,1285.7785,416,1281.7785" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="221" x2="418" y1="1281.7785" y2="1281.7785"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="108" x="228" y="1275.9695">seek(keyframe_ts)</text><polygon fill="#A80036" points="1342.5,1309.4845,1352.5,1313.4845,1342.5,1317.4845,1346.5,1313.4845" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="221" x2="1348.5" y1="1313.4845" y2="1313.4845"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="211" x="228" y="1307.6755">flush decoder &amp; clearFrameQueue()</text><polygon fill="#A80036" points="540,1341.1905,550,1345.1905,540,1349.1905,544,1345.1905" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="221" x2="546" y1="1345.1905" y2="1345.1905"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="269" x="228" y="1339.3815">flush decoder &amp; clear PCM ring &amp; resetClock()</text><polygon fill="#A80036" points="412,1372.8965,422,1376.8965,412,1380.8965,416,1376.8965" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="221" x2="418" y1="1376.8965" y2="1376.8965"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="228" y="1371.0875">read from keyframe -&gt; decode</text><path d="M181.5,1391.8965 L244.5,1391.8965 L244.5,1400.8965 L234.5,1410.8965 L181.5,1410.8965 L181.5,1391.8965 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="83.118" style="stroke: #000000; stroke-width: 2.0;" width="1384.5" x="181.5" y="1391.8965"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="196.5" y="1406.7936">alt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="165" x="259.5" y="1405.6555">[decode until target reached]</text><polygon fill="#A80036" points="1486.5,1431.3086,1496.5,1435.3086,1486.5,1439.3086,1490.5,1435.3086" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="1354.5" x2="1492.5" y1="1435.3086" y2="1435.3086"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="1361.5" y="1429.4996">decode ...</text><polygon fill="#A80036" points="232,1463.0146,222,1467.0146,232,1471.0146,228,1467.0146" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="226" x2="1497.5" y1="1467.0146" y2="1467.0146"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="242" x="238" y="1461.2056">pushFrameToQueue(...)  [N extra frames]</text><polygon fill="#A80036" points="1148.5,1501.7206,1158.5,1505.7206,1148.5,1509.7206,1152.5,1505.7206" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="221" x2="1154.5" y1="1505.7206" y2="1505.7206"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="158" x="228" y="1499.9116">resume device (after reset)</text><polygon fill="#A80036" points="1768.5,1533.4266,1778.5,1537.4266,1768.5,1541.4266,1772.5,1537.4266" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="221" x2="1774.5" y1="1537.4266" y2="1537.4266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="228" y="1531.6176">resume rendering</text><!--MD5=[846e93d4c55d3dd6ce8c72ccd8152f46]
@startuml
actor User
participant Main
participant Player
participant Demuxer
participant "Audio StreamSource\n(decoding thread)" as AudioSource
participant "Audio Decoder\n(+resample)" as AudioDec
participant "Audio Producer\n(thread)" as AudioProducer
participant "PCM Ring\nBuffer" as PCM_RING
participant "SDL Audio\nCallback (audio thread)" as SDLAudioCB
participant "Video StreamSource\n(decoding thread)" as VideoSource
participant "Video Decoder" as VideoDec
participant "Player RenderLoop\n(render thread)" as RenderLoop
participant "GLRenderer\n(render thread)" as Renderer
participant GPU

== Start / Play ==
User -> Main: open(file) & play()
Main -> Player: play()
Player -> Demuxer: open / get streams
Player -> AudioSource: startDecoding()
Player -> VideoSource: startDecoding()

== Audio production path ==
AudioSource -> Demuxer: readNextPacket()
Demuxer - -> AudioSource: packet
AudioSource -> AudioDec: decodePacket()
AudioDec - -> AudioSource: AVFrame (audio)
AudioSource -> AudioProducer: resample & planar→interleaved
AudioProducer -> PCM_RING: pushPCMData(bytes)
note over PCM_RING: ring stores interleaved S16, base_pts set on first frame

loop Device needs audio (periodic)
SDLAudioCB -> PCM_RING: popPCMData(request_len)
PCM_RING - -> SDLAudioCB: bytes or silence
SDLAudioCB -> SDLAudioCB: apply volume (use tmp buffer)
SDLAudioCB -> AudioPlayer: update audio_clock (base_pts + consumed_samples)
end

== Video path and sync ==
VideoSource -> Demuxer: readNextPacket()
Demuxer - -> VideoSource: packet
VideoSource -> VideoDec: decodePacket()
VideoDec - -> VideoSource: AVFrame (video)
VideoSource -> Player: pushFrameToQueue(frame)

Player -> RenderLoop: renderLoop() reads audio_clock
RenderLoop -> Player: request next frame (based on audio_clock / thresholds)
Player -> Renderer: enqueueFrame(selected_frame)
Renderer -> GPU: upload Y/U/V (glTexSubImage2D) + shader (YUV->RGB)
GPU -> Renderer: rasterize & present (swapBuffers)

== Seek flow (user) ==
User -> Player: seek(target_ts)
Player -> SDLAudioCB: pause device
Player -> Renderer: pause rendering
Player -> Demuxer: seek(keyframe_ts)
Player -> VideoSource: flush decoder & clearFrameQueue()
Player -> AudioSource: flush decoder & clear PCM ring & resetClock()
Player -> Demuxer: read from keyframe -> decode
alt decode until target reached
  VideoSource -> VideoDec: decode ...
  VideoDec - -> Player: pushFrameToQueue(...)  [N extra frames]
end
Player -> SDLAudioCB: resume device (after reset)
Player -> Renderer: resume rendering

@enduml

PlantUML version 1.2020.02(Sun Mar 01 18:22:07 CST 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Java Version: 21.0.8+9-Ubuntu-0ubuntu124.04.1
Operating System: Linux
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>